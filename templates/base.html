{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Django Site{% endblock %}</title>
    
    <!-- CSS files -->
    <link rel="stylesheet" href="{% static 'dist/output.css' %}">

    
    {% block extra_head %}
    <!-- Additional head content -->
    {% endblock %}
</head>
<!-- Icons -->
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<body {% if user.is_authenticated %}class="logged-in"{% endif %}>
    <div id="overlay" class="fixed inset-0 bg-black/10 backdrop-blur-xs z-79 hidden"></div>
    <div class="flex h-screen bg-gray-100">
        {% if user.is_authenticated %}
            {% include 'includes/sidebar.html' %}
        {% endif %}
        <div class="flex-1 flex flex-col overflow-hidden {% if user.is_authenticated %}lg:ml-64{% endif %}">
            {% if user.is_authenticated %}
                {% include 'includes/logged_in_header.html' %}
            {% else %}
                {% include 'includes/header_marketing.html' %}
            {% endif %}

            <main id="main-content" class="relative flex-1 w-full overflow-x-hidden overflow-y-auto bg-gray-100">
                {% block content_wrapper %}
                <div class="container w-full mx-auto min-h-screen">
                    {% block content %}
                    <!-- Main content goes here -->
                    {% endblock %}
                </div>
                {% endblock content_wrapper %}
                {% include 'includes/footer.html' %}
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@4.0.1/dist/flowbite.min.js"></script>
    
    <!-- JavaScript files -->
    {% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Find nearest scrollable ancestor (or window)
            function getScrollContainer(el) {
                let parent = el.parentElement;
                while (parent && parent !== document.body) {
                    const style = window.getComputedStyle(parent);
                    const overflowY = style.overflowY;
                    if (overflowY === 'auto' || overflowY === 'scroll' || parent.scrollHeight > parent.clientHeight) {
                        return parent;
                    }
                    parent = parent.parentElement;
                }
                return window;
            }

            // Function to handle smooth scrolling to a target element within the correct container
            function smoothScrollTo(targetId) {
                const targetElement = document.getElementById(targetId);
                if (!targetElement) return;

                const container = getScrollContainer(targetElement);

                if (container === window) {
                    const top = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    window.scrollTo({ top, behavior: 'smooth' });
                } else {
                    const containerRect = container.getBoundingClientRect();
                    const targetRect = targetElement.getBoundingClientRect();
                    const top = targetRect.top - containerRect.top + container.scrollTop;
                    container.scrollTo({ top, behavior: 'smooth' });
                }
            }

            // Handle clicks on navigation links
            document.querySelectorAll('a[href*="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    const targetId = href.substring(href.lastIndexOf('#') + 1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        e.preventDefault();
                        smoothScrollTo(targetId);
                    }
                });
            });

            // Handle direct anchor navigation on page load
            if (window.location.hash) {
                const targetId = window.location.hash.substring(1);
                // Use a small timeout to ensure the page has loaded
                setTimeout(() => {
                    smoothScrollTo(targetId);
                }, 100);
            }
        });
    </script>
    <script src="{% static 'js/header_scroll.js' %}"></script>
    <script src="{% static 'js/sidebar.js' %}"></script>
    {% endblock %}
</body>
</html>